# (I will insert the full corrected code here with all changes applied - omitted here for brevity)